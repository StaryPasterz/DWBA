# DWBA Calculation Configuration
# Helium ion 1s → 2s excitation test configuration

run_name: "He+2s"

calculation:
  type: "excitation"

target:
  atom: "He+"              # Atom from atoms.json: H, He, Li, Ne, Ar, etc.
  # Z: 1.0               # Only needed for custom atoms

states:
  initial:
    n: 1
    l: 0                 # 1s state
  final:
    n: 2
    l: 0                 # 2s state

physics:
  model: "static"        # "static" (article DWBA) or "polarization" (heuristic)

energy:
  type: "log"            # Grid type: "single", "linear", "log", "list"
  start_eV: 10.2         # [eV] First energy point (above threshold)
  end_eV: 300            # [eV] Last energy point
  density: 1           # [dimensionless] Log grid density (higher = more points)
  # step_eV: 10.0        # [eV] For linear grid only
  # values: [10, 20, 50, 100, 200, 500, 1000]  # [eV] For list type only

grid:
  strategy: "local"      # "manual" = fixed params, "global" = adaptive for E_min (recommended), "local" = per-energy
  r_max: 200             # [a.u.] Maximum radial extent (for manual; base value for adaptive)
  n_points: 2000         # [count] Base grid points (for manual; minimum for adaptive modes)
  r_max_scale_factor: 2.5  # [dimensionless] Safety factor for turning point criterion
  n_points_max: 10000    # [count] Maximum allowed grid points (caps adaptive scaling)
  min_points_per_wavelength: 15  # [count] Minimum pts/λ for high-E (v2.7+). Set to 0 to disable.

excitation:
  # Production parameters
  L_max_integrals: 15    # [dimensionless] Max multipole L in Coulomb expansion
  L_max_projectile: 5    # [dimensionless] Base partial wave L_max (auto-scaled)
  n_theta: 200           # [count] Angular grid for DCS integration
  pilot_energy_eV: 1000  # [eV] Calibration pilot energy
  # Pilot light mode (v2.5+) - "auto" = dynamic scaling based on energy, int = explicit value
  # Note (v2.7+): "auto" calculates L_max from k*r_max to ensure convergence at high energies
  pilot_L_max_integrals: 8    # "auto" or int (e.g., 8)
  pilot_L_max_projectile: 30   # "auto" or int (e.g., 30)
  pilot_n_theta: 50            # [count] TCS only, DCS not needed

oscillatory:
  method: "full_split"             # "legacy" | "advanced" | "full_split"
  CC_nodes: 5                    # [count] Clenshaw-Curtis nodes per interval
  phase_increment: 1.5708        # [rad] Phase increment (π/2)
  min_grid_fraction: 0.1         # [dimensionless] Min match point fraction
  k_threshold: 0.5               # [a.u.] Momentum threshold for Filon/Levin
  max_chi_cached: 20             # [count] LRU cache size for continuum waves
  phase_extraction: "hybrid"     # [v2.11+] "hybrid", "logderiv", or "lsq"
  solver: "rk45"                  # [v2.13+] "auto", "rk45" (recommended), "johnson", "numerov"

hardware:
  gpu_block_size: "auto"         # "auto" = auto-tune, int = explicit size
  gpu_memory_mode: "auto"        # "auto" (smart), "full" (fast), "block" (safe)
  gpu_memory_threshold: 0.8      # [dimensionless] Max VRAM fraction to use
  n_workers: "max"               # "auto" (balanced), "max" (all cores), or int

output:
  save_dcs: true                 # Save differential cross section
  save_partial: true             # Save partial wave contributions
  calibrate: true                # Apply Tong empirical calibration

